---
title: "corrina1"
author: "Corrina Pascale"
date: "3/21/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(leaflet)
library(dplyr)
```

```{r}
meteorological <- read_csv("Data/Meteorological Data.csv")
sensor <- read_csv("Data/Sensor Data.csv")
traffic <- read_csv("Data/Lekagul Sensor Data.csv")
# factory and chemical sensor coordinates:
coord <- read_csv('Data/coordinates.csv')

roadways <- readJPEG('Lekagul Roadways labeled v2.jpg') 


```


```{r}
m <- coord %>%
  leaflet() %>%
  setView(200, 200, zoom = 1) %>%
  addMarkers(lng=coord$longitude, lat=coord$latitude, popup=coord$item)
m
```
```{r}
m2 <- leaflet(data = coord,
        height=400,
        width=400,
        options = leafletOptions(crs = leafletCRS('L.CRS.Simple'))) %>% 
        setView(200, 200, zoom = -1) %>%
  addMarkers(~longitude, ~latitude, popup=~item)
m2
```




```{r does not work }
require(magick) # image loading
require(htmlwidgets) # render JS function
library(tidyverse)
library(leaflet)

# tried unsuccessfully with these other 2 methods : 

#roadways <- base64Encode('Lekagul Roadways labeled v2.jpg')
#imageURL <- 'file:///Users/corrinapascale/Desktop/DC3/Lekagul%20Roadways%20labeled%20v2.jpg'

b64img <- knitr::image_uri('Lekagul Roadways labeled v2.jpg')
roadways2 <- 'Lekagul Roadways labeled v2.jpg'

imageData <- 
    image_read(roadways2) %>% image_info()

leaflet(data = coord,
        height=400,
        width=400,
        options = leafletOptions(crs = leafletCRS('L.CRS.Simple'))) %>% 
        setView(200, 200, zoom = -1) %>%
        onRender(glue::glue("
      function(el, x) {
        var myMap = this;
        var imageUrl = '<roadways2>';
        var imageBounds = [[<0>,<0>], [<imageData$height>,<imageData$width>]];
        L.imageOverlay(roadways2, imageBounds).addTo(myMap);
      }
      ",.open = '<', .close = '>')) %>% 
  addMarkers(~latitude, ~longitude, popup=~item)
```

```{r}
#Filter chemical that is the most harmful and has highest reading levels
sd1 <- filter(sensor, Chemical == "Methylosmolene")
# Which monitor read Methylosmolene the most?
sd1$Monitor <- as.factor(sd1$Monitor) #make "Monitor" categorical
ggplot(data = sd1, mapping = aes(x = Monitor, y= Reading)) +
  geom_col()
```

```{r}
# wrangling sensor & wind data

library(lubridate)
library(stringr)
rm(sensor2, meteorological2, M)

sensor2 <- sensor %>%
  rename("datetime" = "Date Time") %>%
  separate(datetime, c("date", "time"), sep = " ")

meteorological2 <- meteorological %>%
  separate(Date, c("date", "time"), sep = " ") %>%
  inner_join(sensor2, by = "date")

M <- meteorological2 %>%
  filter(Chemical == 'Methylosmolene') %>%
  filter(Monitor == 3 | Monitor == 4 | Monitor == 6)

```
```{r}
class(sensor2$date)

sensor_ag <- sensor2 %>%
  mutate(date = as.Date(date)) 
  # mutate(date_ag = floor_date(ymd_hms(date), "month"))
class(sensor2$date)

```


```{r}
sensor_time_plot <- ggplot(data = sensor, aes(`Date Time`, Reading)) +
    geom_point() +
  facet_wrap(vars(Monitor), scales = "free") 

sensor_time_plot

```

```{r}


```

